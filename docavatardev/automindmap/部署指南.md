# AI思维导图工具部署指南

## 快速开始

### Windows用户

#### 方法一：双击运行（推荐）
1. 双击运行 `一键启动.bat`
2. 等待依赖自动安装
3. 浏览器会自动打开 http://localhost:3000

#### 方法二：Docker部署
1. 安装 [Docker Desktop](https://www.docker.com/products/docker-desktop/)
2. 双击运行 `docker一键启动.bat`
3. 浏览器打开 http://localhost:3000

### Linux/macOS用户

#### 方法一：命令行运行
```bash
# 赋予执行权限
chmod +x start.sh

# 运行脚本
./start.sh
```

#### 方法二：Docker部署
```bash
# 赋予执行权限
chmod +x docker-start.sh

# 运行脚本
./docker-start.sh
```

## 详细部署说明

### 1. 系统要求

**最低配置：**
- Node.js 16.0 或更高版本
- 2GB RAM
- 1GB 磁盘空间

**推荐配置：**
- Node.js 18.0 或更高版本
- 4GB RAM
- 2GB 磁盘空间

### 2. 传统部署步骤

#### 安装Node.js

**Windows:**
1. 访问 https://nodejs.org/
2. 下载LTS版本
3. 运行安装程序

**Ubuntu/Debian:**
```bash
curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
sudo apt-get install -y nodejs
```

**CentOS/RHEL:**
```bash
curl -fsSL https://rpm.nodesource.com/setup_lts.x | sudo bash -
sudo yum install -y nodejs
```

**macOS:**
```bash
brew install node
```

#### 安装依赖
```bash
npm install
```

#### 启动服务
```bash
npm start
# 或
node server.js
```

### 3. Docker部署

#### 安装Docker

**Windows:**
下载并安装 [Docker Desktop](https://www.docker.com/products/docker-desktop/)

**Linux:**
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install docker.io docker-compose

# CentOS/RHEL
sudo yum install docker docker-compose
sudo systemctl start docker
sudo systemctl enable docker
```

**macOS:**
```bash
brew install docker docker-compose
```

#### 构建和运行
```bash
# 构建镜像
docker-compose build

# 启动服务
docker-compose up -d

# 查看日志
docker-compose logs -f

# 停止服务
docker-compose down
```

### 4. 高级配置

#### 环境变量

可以在 `.env` 文件中设置以下环境变量：

```bash
# 服务器配置
PORT=3000
NODE_ENV=production

# API配置（可选）
OPENAI_API_KEY=your_openai_key
QWEN_API_KEY=your_qwen_key
KIMI_API_KEY=your_kimi_key

# 文件上传限制
MAX_FILE_SIZE=50MB
MAX_FILES=100
```

#### Nginx反向代理配置

创建 `nginx.conf` 文件：

```nginx
events {
    worker_connections 1024;
}

http {
    upstream app {
        server ai-mindmap:3000;
    }

    server {
        listen 80;
        server_name localhost;

        location / {
            proxy_pass http://app;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
    }
}
```

### 5. 故障排除

#### 端口被占用
```bash
# Windows
netstat -ano | findstr :3000
taskkill /PID <PID> /F

# Linux/macOS
lsof -ti:3000 | xargs kill -9
```

#### 权限问题（Linux/macOS）
```bash
sudo chmod +x start.sh
docker sudo usermod -aG docker $USER
```

#### 依赖安装失败
```bash
# 清除缓存
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

#### Docker构建失败
```bash
# 清除缓存
docker system prune -a
docker-compose build --no-cache
```

### 6. 验证部署

#### 健康检查
访问 http://localhost:3000/health 应该返回 "OK"

#### 功能测试
1. 上传PDF文件
2. 上传图片文件
3. 输入文本内容
4. 测试语音朗读功能

### 7. 生产环境部署

#### 使用PM2（Node.js）
```bash
npm install -g pm2
pm2 start server.js --name ai-mindmap
pm2 save
pm2 startup
```

#### 使用Systemd（Linux）
创建 `/etc/systemd/system/ai-mindmap.service`：

```ini
[Unit]
Description=AI Mindmap Server
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/path/to/your/project
ExecStart=/usr/bin/node server.js
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

启用服务：
```bash
sudo systemctl enable ai-mindmap
sudo systemctl start ai-mindmap
```

### 8. 更新指南

#### 代码更新
```bash
git pull origin main
npm install
pm2 restart ai-mindmap  # 如果使用PM2
```

#### Docker更新
```bash
docker-compose pull
docker-compose up -d --force-recreate
```

## 技术支持

如遇到问题，请：
1. 查看控制台错误信息
2. 检查日志文件
3. 提交Issue到项目仓库

## 性能优化建议

1. **内存优化**：设置NODE_OPTIONS="--max-old-space-size=4096"
2. **文件缓存**：配置CDN加速静态资源
3. **数据库**：考虑使用Redis缓存API响应
4. **负载均衡**：使用Nginx进行多实例负载均衡