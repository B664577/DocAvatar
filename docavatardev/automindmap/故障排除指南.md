# 智图AI 故障排除指南

## 🚨 AI处理失败："Failed to fetch" 错误

### 问题描述
当点击"AI处理内容"按钮时，出现"AI处理失败: Failed to fetch"错误。

### 可能原因和解决方案

#### 1. 网络连接问题
**症状**: 显示"Failed to fetch"错误
**解决方案**:
- 检查网络连接是否正常
- 尝试访问其他网站确认网络状态
- 重启路由器或切换网络

#### 2. API密钥配置问题
**症状**: API调用被拒绝
**解决方案**:
- 检查API密钥是否正确输入
- 确认API密钥是否有效（未过期）
- 重新生成API密钥并更新

#### 3. 科学上网问题（针对OpenAI）
**症状**: 无法访问OpenAI API
**解决方案**:
- 确保科学上网工具正常运行
- 检查代理设置是否正确
- 尝试切换代理节点

#### 4. API服务商问题
**症状**: 特定AI模型无法使用
**解决方案**:
- 检查API服务商状态页面
- 尝试切换到其他AI模型
- 稍后重试

### 🔧 详细排查步骤

#### 步骤1: 检查基础配置
1. 打开浏览器开发者工具（F12）
2. 切换到"Console"标签
3. 查看是否有错误信息
4. 检查"Network"标签中的请求状态

#### 步骤2: 验证API密钥
1. 点击"展开配置"
2. 确认选择的AI模型
3. 重新输入API密钥
4. 点击"保存"

#### 步骤3: 测试网络连接
```bash
# 测试通义千问API连接
curl -I https://dashscope.aliyuncs.com

# 测试通义千问OpenAI兼容模式
curl -I https://dashscope.aliyuncs.com/compatible-mode/v1

# 测试OpenAI API连接
curl -I https://api.openai.com
```

#### 步骤3.1: 通义千问专项测试
```bash
# 使用您的API密钥测试通义千问API
curl -X POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "qwen-plus",
    "messages": [
      {"role": "user", "content": "你好"}
    ]
  }'
```

#### 步骤4: 清除缓存
1. 清除浏览器缓存
2. 重新加载页面
3. 重新配置API密钥

### 📋 API配置检查清单

#### 通义千问 (Qwen)
- [ ] API密钥格式正确（sk-开头，来自阿里云百炼平台）
- [ ] 账户余额充足（检查阿里云账户余额）
- [ ] API权限正常（确保开通了通义千问服务）
- [ ] 网络可访问阿里云服务（dashscope.aliyuncs.com）
- [ ] 使用正确的模型名称（qwen-plus、qwen-turbo等）

**通义千问API密钥获取方式**：
1. 访问 [阿里云百炼平台](https://dashscope.aliyuncs.com/)
2. 登录阿里云账号
3. 在API-KEY管理中创建新的API密钥
4. 复制以"sk-"开头的API密钥

#### OpenAI GPT
- [ ] API密钥格式正确（sk-开头）
- [ ] 账户余额充足
- [ ] API使用限制未超出
- [ ] 科学上网工具正常

### 🛠️ 常见错误代码

| 错误代码 | 含义 | 解决方案 |
|---------|------|----------|
| 401 | API密钥无效 | 检查并重新输入正确的API密钥 |
| 403 | 访问被拒绝 | 检查账户状态和API权限 |
| 429 | 请求频率超限 | 稍后重试或升级API套餐 |
| 500 | 服务器内部错误 | 稍后重试或联系API服务商 |

### 🔍 通义千问特定错误

| 错误信息 | 可能原因 | 解决方案 |
|---------|---------|----------|
| "Failed to fetch" | 网络连接问题 | 检查网络连接，确保能访问阿里云服务 |
| "API密钥无效" | 密钥错误或过期 | 重新生成API密钥 |
| "账户余额不足" | 阿里云账户欠费 | 充值阿里云账户 |
| "模型不存在" | 模型名称错误 | 使用正确的模型名称（qwen-plus） |
| "请求参数错误" | 请求格式不正确 | 检查消息格式和参数 |

### 🔄 重启应用

如果以上方法都无效，尝试重启应用：

1. **关闭当前服务**:
   ```bash
   # 在终端中按 Ctrl+C 停止服务
   ```

2. **检查端口占用**:
   ```bash
   netstat -ano | findstr :3000
   ```

3. **强制结束进程**（如果需要）:
   ```bash
   taskkill /PID [进程ID] /F
   ```

4. **重新启动**:
   ```bash
   npm start
   ```

### 📞 获取帮助

如果问题仍然存在，请：

1. **收集错误信息**:
   - 浏览器控制台错误日志
   - 网络请求详情
   - 使用的AI模型和配置

2. **联系支持**:
   - 提交GitHub Issue
   - 发送邮件到技术支持
   - 查看项目文档和FAQ

### 🎯 医学思维导图助手专用配置

您的默认提示词已更新为医学专用版本：

**系统提示词**:
```
你是一个专业的医学思维导图助手，擅长将医学内容转换为结构化的思维导图。请严格按照用户要求的步骤进行处理，确保医学术语的准确性和内容的逻辑性。
```

**用户提示词模板**:
```
医学思维导图助手应在处理用户提供的信息时，依此依照下面步骤为我整理：

1. 内容纠错与专业术语校验
2. 头脑风暴、思维拓展与归纳整理  
3. Markdown思维导图的结构化与细化
4. 重要程度词语括号标注
5. 标点符号分割和分支细化
6. 制作精确的结构化思维导图
7. 使用Markdown格式展示
8. 层次分明，易于记忆理解
```

### ✅ 成功使用提示

当AI处理成功时，您会看到：
- "AI分析完成！结果已显示在Markdown编辑器中。"
- Markdown编辑器中出现结构化的医学思维导图
- 可以点击"朗读内容"进行语音播放

---

**记住**: 智图AI专为医学内容优化，确保专业术语的准确性和逻辑结构的清晰性。 